!function(e,n){"function"==typeof define&&define.amd?define(n):"object"==typeof exports?module.exports=n():e.myModulefunction=n()}(this,function(){document,window;var f,i,t=function(){console.log("myModuleLoaded")};return t.setupVideo=function(e){var n=document.createElement("video");return n.controls=!0,n.id="video_source",n.className="video-js",n.height=300,n.preload="auto",e.appendChild(n),videojs("video_source",{sources:{src:"",type:"video/mp4"}})},t.gettype=function(){return console.log(typeof t)},t.on=function(e,n){e.removeEventListener("msg",n,!1),e.addEventListener("msg",n,!1)},t.initaudio=function(c){var e,d,s,u,l,n=new window.AudioContext,m=10,f=10;(d=document.createElement("audio")).src="https://wavesurfer-js.org/example/split-channels/stereo.mp3",d.id="audio",d.controls="controls",d.autoplay="autoplay",d.crossOrigin="anonymous",(u=document.createElement("canvas")).width=c.offsetWidth,u.height=200,u.id="canvasFormAudio",c.appendChild(d),c.appendChild(u),l=u.getContext("2d"),e=new window.AudioContext,s=e.createAnalyser();n=d;var t=e.createMediaElementSource(n),o=e.createGain();function v(){u.width=c.offsetWidth;var e=u.width,n=u.height;if(console.log(d.paused),d.paused)return requestAnimationFrame(v),void(f=m);if(f<m)return f++,void requestAnimationFrame(v);s.fftSize=128;var t=s.frequencyBinCount;console.log(t);var o=new Uint8Array(s.frequencyBinCount);s.getByteFrequencyData(o),console.log("draw"),l.clearRect(0,0,e,n);var i=e/(2*o.length);l.fillStyle="white";for(var a=0;a<o.length;a++){var r=Math.max(n*o[a]/255,1);l.fillRect((a+t)*i,(n-r)/2,.8*i,r),l.fillRect((t-a)*i,(n-r)/2,.8*i,r)}f=0,requestAnimationFrame(v)}t.connect(s),s.connect(e.destination),t.connect(o),o.connect(e.destination),window.addEventListener("load",function(e){v()},!1)},t.inittimeaudio=function(c){var e,d,s,u,l,m,n=new window.AudioContext,f=1,v=1,w=[];(d=document.createElement("audio")).src="https://wavesurfer-js.org/example/split-channels/stereo.mp3",d.id="audio",d.controls="controls",d.autoplay="autoplay",d.crossOrigin="anonymous",d.addEventListener("pause",function(){console.error("pause"),console.log(m),window.cancelAnimationFrame(m)},!1),d.addEventListener("play",function(){m=requestAnimationFrame(p)},!1),(u=document.createElement("canvas")).width=c.offsetWidth,u.height=200,u.id="canvasFormAudio",c.appendChild(d),c.appendChild(u),l=u.getContext("2d"),e=new window.AudioContext,s=e.createAnalyser();n=d;var t=e.createMediaElementSource(n),o=e.createGain();function p(){if(console.log(d.paused),d.paused)return window.cancelAnimationFrame(m),void(v=f);if(v<f)return v++,m=requestAnimationFrame(p),void console.log(m);u.width=c.offsetWidth;var e=u.width,n=u.height;s.fftSize=128;var t=s.fftSize,o=new Float32Array(t);s.getFloatTimeDomainData(o);w.push(o.sort(function(e,n){return n-e})[0]),console.log(o.sort(function(e,n){return n-e})[0]),128<w.length&&w.shift(),l.clearRect(0,0,e,n);var i=e/256;l.fillStyle="black";for(var a=0;a<w.length;a++){var r=Math.max(n*w[a],1);l.fillRect(a*i*2,(n-r)/2,.8*i*2,r)}v=0,m=requestAnimationFrame(p),console.log(m)}t.connect(s),s.connect(e.destination),t.connect(o),o.connect(e.destination),window.addEventListener("load",function(e){p()},!1)},t.initCustomAudio=function(e,n){null!=i&&null!=i?i.close().then(function(){console.log("close"),t.CustomAudio(e,n)}):t.CustomAudio(e,n)},t.CustomAudio=function(r,c,d,e){var n,t,s,u=e,l=e,o=c;function m(){if(c.paused)return window.cancelAnimationFrame(f),void(l=u);if(l<u)return l++,void(f=requestAnimationFrame(m));s.fftSize=d;var e=s.fftSize,n=new Float32Array(e);s.getFloatTimeDomainData(n);var t=n.sort(function(e,n){return n-e}),o=Math.abs(t[0]),i=-Math.abs(t[t.length-1]),a=new CustomEvent("msg",{detail:[o,i]});r.dispatchEvent(a),l=0,f=requestAnimationFrame(m)}c.crossOrigin="anonymous",window.cancelAnimationFrame(f),c.removeEventListener("pause",function(){console.error("pause"),console.log(f),window.cancelAnimationFrame(f)},!1),c.removeEventListener("play",function(){f=requestAnimationFrame(m)},!1),i=new window.AudioContext,s=i.createAnalyser(),n=i.createMediaElementSource(o),t=i.createGain(),n.connect(s),s.connect(i.destination),n.connect(t),t.connect(i.destination),window.addEventListener("load",function(e){m()},!1),c.addEventListener("pause",function(){console.error("pause"),console.log(f),window.cancelAnimationFrame(f)},!1),c.addEventListener("play",function(){f=requestAnimationFrame(m)},!1)},t});